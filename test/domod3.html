<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="../dist/domod.js" charset="utf-8"></script>
    <style>
        .red {
            color: red;
        }
    </style>
</head>
<body>
    <form>
        <div>
            <input type="radio" name="gender" value="male" m-checked="$form.gender === 'male' ? 'checked' : undefined">Male
            <input type="radio" name="gender" value="female" m-checked="$form.gender === 'female' ? 'checked' : undefined">Female
        </div>
        <div>
            <input type="text" name="mobile" m-value="$form.mobile">
            <span m-style="{ display: !!$form.mobile ? 'inline' : 'none' }">You input: {{$parse($form.mobile)}}.</span>
            <span m-class="['some-class', { red: !$mobileInputStatus }]" m-style="{ display: !$mobileInputStatus ? 'inline' : 'none' }">{{$form.mobile}} is {{$mobileInputStatus}}!</span>
        </div>
        <div>
            <select name="age" m-value="$form.age.value">
                <option value="1">0-18</option>
                <option value="2">19-36</option>
                <option value="3">37-54</option>
                <option value="4">55-200</option>
            </select>
        </div>
    </form>
    <pre>{{JSON.stringify($form, null, 4)}}</pre>
    <script>
        var store = {
            parse: function (v) {
                return parseInt(v);
            },
            validateMobile: function () {
                return /^1[3|4|5|8][0-9]\d{8}$/.test(this.form.mobile);
            },
            form: {
                gender: 'male',
                mobile: '15210001000',
                age: {
                    value: '3',
                    options: {
                        '1': '0-18',
                        '2': '19-36',
                        '3': '37-54',
                        '4': '55-200'
                    }
                }
            }
        };

        /* Declare a computed property: */
        // DMD.relate(store, {
        //     mobileInputStatus: {
        //         upstream: 'form.mobile',
        //         resultFrom: function () {
        //             var newVal = store.validateMobile();
        //             console.log(`mobile is ${newVal}`);
        //             return newVal;
        //         }
        //     }
        // });

        /* Watch a property mutation */
        store.mobileInputStatus = store.validateMobile();
        DMD.relate(store, {
            'form.mobile': {
                dnstream: 'mobileInputStatus',
                resultIn: function (v) {
                    var newVal = store.validateMobile();
                    console.log(`mobile is ${newVal}`);
                    DMD.$(store, 'mobileInputStatus', newVal);
                }
            }
        });

        DMD(document.body, store);
    </script>
</body>
</html>