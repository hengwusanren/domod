{"version":3,"file":"domod.min.js","sources":["../src/Util.js","../src/OArray.js","../src/Kernel.js","../src/Parser.js","../src/index.js"],"sourcesContent":["var gid = (function () {\n    var n = 0;\n    return function () {\n        return n++;\n    };\n})();\n\nvar isBoolean = function (v) {\n    return typeof v === 'boolean';\n};\n\nvar isNumber = function (v) {\n    return typeof v === 'number';\n};\n\nvar isNumeric = function (v) {\n    var n = parseInt(v);\n    if (isNaN(n)) return false;\n    return (typeof v === 'number' || typeof v === 'string') && n == v;\n};\n\nvar isString = function (v) {\n    return typeof v === 'string';\n};\n\nvar isFunction = function (v) {\n    return typeof v === 'function';\n};\n\nvar isObject = function (v) {\n    return v != null && Object.prototype.toString.call(v) === '[object Object]';\n};\n\nvar isArray = function (v) {\n    return Object.prototype.toString.call(v) === '[object Array]';\n};\n\nvar isBasic = function (v) {\n    return v == null\n        || typeof v === 'boolean'\n        || typeof v === 'number'\n        || typeof v === 'string'\n        || typeof v === 'function';\n};\n\nvar isInstance = function (v, creator) {\n    return typeof creator === 'function' && v instanceof creator;\n};\n\nvar isDirectInstance = function (v, creator) {\n    return v.constructor === creator;\n};\n\nvar isNode = function (v) {\n    if (typeof Node !== 'function') return false;\n    return v instanceof Node;\n};\n\nvar isNamedNodeMap = function (v) {\n    return v instanceof NamedNodeMap;\n};\n\nvar isEventName = function (v) {\n    if (!isString(v) || !v.startsWith('on')) return false;\n    return v.substr(2); // TODO\n};\n\nvar isCSSSelector = function (v) {\n    return v.indexOf(' ') > 0 || v.indexOf('.') >= 0\n        || v.indexOf('[') >= 0 || v.indexOf('#') >= 0;\n};\n\nvar each = function (v, func, arrayReverse) {\n    var i;\n    var len;\n    if (isObject(v) && isFunction(v.forEach)) {\n        v.forEach(func);\n    } else if (isObject(v)) {\n        for (var p in v) {\n            if (!v.hasOwnProperty(p)) continue;\n            if (func(v[p], p) === false) break;\n        }\n    } else if (isArray(v)) {\n        if (!arrayReverse) {\n            for (i = 0, len = v.length; i < len; i++) {\n                if (func(v[i], i) === false) break;\n            }\n        } else {\n            for (i = v.length - 1; i >= 0; i--) {\n                if (func(v[i], i) === false) break;\n            }\n        }\n    } else if (isNode(v)) {\n        var ret = false;\n        switch (v.nodeType) {\n        case Node.ELEMENT_NODE:\n            break;\n        case Node.TEXT_NODE:\n        case Node.COMMENT_NODE:\n        case Node.PROCESSING_INSTRUCTION_NODE:\n        case Node.DOCUMENT_NODE:\n        case Node.DOCUMENT_TYPE_NODE:\n        case Node.DOCUMENT_FRAGMENT_NODE:\n        default:\n            ret = true;\n        }\n        if (ret) return;\n        var childNodes = v.childNodes;\n        for (i = 0, len = childNodes.length; i < len; i++) {\n            func(childNodes[i]);\n            each(childNodes[i], func);\n        }\n    } else if (isNamedNodeMap(v)) {\n        for (i = 0, len = v.length; i < len; i++) {\n            if (func(v[i]['nodeValue'], v[i]['nodeName']) === false) break;\n        }\n    }\n};\n\nvar eachIndexOf = function (str, pat) {\n    var p0 = 0;\n    var p1;\n    var len = str.length;\n    var r = [];\n    while (p0 < len) {\n        p1 = str.indexOf(pat, p0);\n        if (p1 < len) {\n            r.push(p1);\n            p0 = p1 + pat.length;\n        }\n    }\n    return r;\n};\n\nvar eachUnique = function (arr, func) {\n    if (!isArray(arr)) return;\n    var map = {};\n    for (var i = 0, len = arr.length; i < len; i++) {\n        if (!isNumber(arr[i]) || !isString(arr[i]) || map[arr[i]]) continue;\n        map[arr[i]] = true;\n        var r = func(arr[i]);\n        if (r === false) break;\n    }\n};\n\nvar unique = function (arr) {\n    var r = [];\n    eachUnique(arr, function (v) {\n        r.push(v);\n    });\n    return r;\n};\n\nvar clone = function (val) {\n    var r = val;\n    if (isObject(val)) {\n        r = {};\n        each(val, function (v, p) {\n            r[p] = clone(v);\n        });\n    } else if (isArray(val)) {\n        r = [];\n        each(val, function (v) {\n            r.push(clone(v));\n        });\n    }\n    return r;\n};\n\nvar hasProperty = function (val, p) {\n    if (isObject(val)) {\n        return val.hasOwnProperty(p);\n    } else if (isArray(val)) {\n        var n = parseInt(p);\n        return isNumeric(p) && val.length > n && n >= 0;\n    }\n    return false;\n};\n\nvar clear = function (val, p, withBasicVal) {\n    var inRef = isString(p) || isNumber(p);\n    var target = inRef ? val[p] : val;\n\n    if (isObject(target) || isArray(target)) {\n        each(target, function (v, p) {\n            clear(target, p);\n        });\n        if (isArray(target)) {\n            shrinkArray(target);\n        }\n    }\n\n    if (inRef) {\n        val[p] = withBasicVal;\n    }\n};\n\nvar shrinkArray = function (arr, len) {\n    var limited = isNumber(len);\n    if (!limited) {\n        each(arr, function (v, i) {\n            if (v === undefined) arr.length--;\n        }, true);\n    } else {\n        each(arr, function (v, i) {\n            if (i >= len) arr.length--;\n            else return false;\n        }, true);\n        while (arr.length < len) {\n            arr.push(null);\n        }\n    }\n    return arr;\n};\n\nvar touchLeaves = function (obj) {\n    each(obj, function (v, p) {\n        if (isBasic(v)) {\n            obj[p] = v;\n        } else {\n            touchLeaves(v);\n        }\n    });\n};\n\nvar extend = function (dest, srcs, clean, handler) {\n    if (!isObject(dest)) return srcs;\n    var args;\n    var argOffset = 0;\n    handler = undefined;\n    clean = false;\n    var lastArg = arguments[arguments.length - 1];\n    if (isFunction(lastArg)) {\n        argOffset = 2;\n        handler = lastArg;\n        clean = !!arguments[arguments.length - 2];\n    } else if (lastArg === true) {\n        argOffset = 1;\n        clean = lastArg;\n    }\n    args = Array.prototype.slice.call(arguments, 1, arguments.length - argOffset);\n\n    function extendObj(obj, src, clean) {\n        if (!isObject(src)) return src;\n        each(src, function (v, p) {\n            if (!hasProperty(obj, p) || isBasic(v)) {\n                if (obj[p] !== v) {\n                    obj[p] = clone(v);\n                }\n            } else {\n                obj[p] = extendObj(obj[p], v, clean);\n            }\n        });\n        if (clean) {\n            each(obj, function (v, p) {\n                if (!hasProperty(src, p)) {\n                    clear(obj, p);\n                }\n            });\n            if (isArray(obj)) {\n                shrinkArray(obj);\n            }\n        }\n        return obj;\n    }\n\n    each(args, function (src) {\n        dest = extendObj(dest, src, clean);\n    });\n    return dest;\n};\n\nvar allRefs = function (obj) {\n    if (obj instanceof Array) return [];\n    var refs = [];\n    each(obj, function (v, p) {\n        refs.push(p);\n        if (isObject(v)) {\n            var f = allRefs(v);\n            each(f, function (pp) {\n                refs.push(p + '.' + pp);\n            });\n        }\n    })\n    return refs;\n};\n\nvar hasRef = function (root, refPath) {\n    var v = root;\n    var paths = refPath.split('.');\n    while (paths.length) {\n        var p = paths.shift();\n        if (!hasProperty(v, p)) return false;\n        v = v[p];\n    }\n    return true;\n};\n\nvar seekTarget = function (refPath, root) {\n    var args = Array.prototype.slice.call(arguments, 1);\n    var v;\n    for (var i = 0, len = args.length; i < len; i++) {\n        v = args[i];\n        if (isArray(v)) {\n            var r = seekTarget.apply(null, [refPath].concat(v));\n            if (r) return r;\n        } else {\n            if (hasRef(v, refPath)) return v;\n        }\n    }\n};\n\nvar seekTargetIndex = function (refPath, roots) {\n    var index = roots.length - 1;\n    each(roots, function (v, i) {\n        if (hasRef(v, refPath)) {\n            index = i;\n            return false;\n        }\n    });\n    return index;\n};\n\nvar refData = function (root, refPath, value) {\n    var toSet = arguments.length >= 3;\n    var v = root;\n    var paths = [];\n    if (refPath) paths = refPath.split('.');\n\n    if (!toSet) {\n        while (paths.length) {\n            if (isBasic(v)) return undefined;\n            v = v[paths.shift()];\n        }\n        return v;\n    } else {\n        while (paths.length) {\n            if (isBasic(v)) return undefined;\n            if (paths.length === 1) {\n                v[paths.shift()] = value;\n            } else {\n                v = v[paths.shift()];\n            }\n        }\n        return value;\n    }\n};\n\nfunction addEvent($el, eventName, handler, useCapture) {\n    if ($el.addEventListener) {\n        $el.addEventListener(eventName, handler, !!useCapture);\n    } else {\n        if (eventName === 'input') {\n            eventName = 'propertychange';\n        }\n        $el.attachEvent('on' + eventName, handler);\n    }\n}\n\nfunction flatten(root, objectFilter, clean) {\n    objectFilter = objectFilter || function () { return true; };\n    var ext = {};\n    each(root, function (v, p) {\n        if (isObject(v) && !objectFilter(v)) {\n            var f = flatten(v, objectFilter, clean);\n            each(f, function (vv, pp) {\n                ext[p + '.' + pp] = vv;\n            });\n        } else {\n            if (objectFilter(v) || !clean) {\n                ext[p] = v;\n            }\n        }\n    })\n    return ext;\n}\n\nexport {\n    gid,\n    isBoolean,\n    isNumber,\n    isNumeric,\n    isString,\n    isFunction,\n    isObject,\n    isArray,\n    isBasic,\n    isInstance,\n    isDirectInstance,\n    isNode,\n    isNamedNodeMap,\n    isEventName,\n    isCSSSelector,\n    each,\n    eachIndexOf,\n    eachUnique,\n    unique,\n    clone,\n    hasProperty,\n    clear,\n    shrinkArray,\n    touchLeaves,\n    extend,\n    allRefs,\n    hasRef,\n    seekTarget,\n    seekTargetIndex,\n    refData,\n    addEvent,\n    flatten\n}\n","import * as Util from './Util'\n\nvar canUseProxy = typeof Proxy === 'function';\n\nfunction defineProperty(target, prop, desc) {\n    if (Object.defineProperty) {\n        Object.defineProperty(target, prop, desc);\n    } else {\n        if ('value' in desc) {\n            target[prop] = desc.value;\n        }\n    }\n}\n\nfunction OArray(arr, option) {\n    if (Util.isObject(arr) && arguments.length === 1) option = arr;\n    if (!Util.isArray(arr)) arr = [];\n    if (!option) option = {};\n\n    defineProperty(this, '__data', {\n        value: arr\n    });\n\n    defineProperty(this, 'length', {\n        get: function () {\n            return arr.length;\n        },\n        set: function (v) {\n            arr.length = v;\n        }\n    });\n\n    var _this = this;\n\n    var eventNames = ['set', 'push', 'pop', 'unshift', 'shift', 'splice'];\n    eventNames.forEach(function (e) {\n        defineProperty(_this, 'on' + e, { value: [] });\n    });\n    eventNames.forEach(function (e) {\n        _this.addEventListener(e, option['on' + e]);\n    });\n\n    Util.each(arr, function (v, i) {\n        _this.assignElement(i);\n    });\n}\n\nOArray.prototype = [];\nOArray.prototype.constructor = OArray;\n\nOArray.prototype.addEventListener = function (eventName, handler) {\n    var _this = this;\n    if (Util.isObject(eventName)) {\n        Util.each(eventName, function (hdl, evt) {\n            _this.addEventListener(evt, hdl);\n        });\n        return;\n    }\n    if (!this['on' + eventName] || !Util.isFunction(handler)) return;\n    this['on' + eventName].push(handler);\n};\nOArray.prototype.on = OArray.prototype.addEventListener;\n\nOArray.prototype.removeEventListener = function (eventName, handler) {\n    var _this = this;\n    if (Util.isObject(eventName)) {\n        Util.each(eventName, function (hdl, evt) {\n            _this.removeEventListener(evt, hdl);\n        });\n        return;\n    }\n    if (!this['on' + eventName] || !Util.isFunction(handler)) return;\n    var handlers = this['on' + eventName];\n    Util.each(handlers, function (h, i) {\n        if (h === handler) {\n            handlers.splice(i, 1);\n            return false;\n        }\n    });\n};\nOArray.prototype.off = OArray.prototype.removeEventListener;\n\nOArray.prototype.dispatchEvent = function (eventName, args) {\n    args = Array.prototype.slice.call(arguments, 1);\n    var _this = this;\n    Util.each(this['on' + eventName], function (handler) {\n        handler.apply(_this, args);\n    });\n};\nOArray.prototype.trigger = OArray.prototype.dispatchEvent;\n\nOArray.prototype.get = function (i) {\n    return this.__data[i];\n};\n\nOArray.prototype.set = function (i, v) {\n    var e = this.__data[i];\n    if (Util.isBasic(e) || Util.isBasic(v)) {\n        this.dispatchEvent('set', e, v, i, this.__data);\n        this.__data[i] = v;\n    } else {\n        Util.extend(e, v, true);\n    }\n};\n\nOArray.prototype.assignElement = function (i) {\n    defineProperty(this, i, {\n        get: function () {\n            return this.get(i);\n        },\n        set: function (val) {\n            this.set(i, val);\n        },\n        configurable: true,\n        enumerable: true\n    });\n};\nOArray.prototype.deleteElement = function () {\n    if (this.hasOwnProperty(this.length - 1)) delete this[this.length - 1];\n};\n\n['push', 'unshift'].forEach(function (f) {\n    OArray.prototype[f] = function (v) {\n        this.__data[f](v);\n        this.assignElement(this.length - 1);\n        this.dispatchEvent(f, v);\n    };\n});\n['pop', 'shift'].forEach(function (f) {\n    OArray.prototype[f] = function () {\n        this.dispatchEvent(f, this.__data[f === 'pop' ? (this.length - 1) : 0]);\n        this.deleteElement();\n        this.__data[f]();\n    };\n});\n\nOArray.prototype.toArray = function (notClone) {\n    return notClone ? this.__data : Util.clone(this.__data);\n};\n\nOArray.prototype.splice = function (startIndex, howManyToDelete, itemToInsert) {\n    if (!Util.isNumber(startIndex) || startIndex < 0) startIndex = 0;\n    if (startIndex >= this.length) startIndex = this.length;\n    if (!Util.isNumber(howManyToDelete) || howManyToDelete < 0) howManyToDelete = 0;\n    if (howManyToDelete + startIndex > this.length) howManyToDelete = this.length - startIndex;\n\n    var itemsToDelete = [];\n    for (var i = startIndex; i < startIndex + howManyToDelete; i++) {\n        itemsToDelete.push(Util.clone(this.get(i)));\n    }\n\n    var itemsToInsert = Array.prototype.slice.call(arguments, 2);\n    var howManyToInsert = itemsToInsert.length;\n\n    var howManyToSet = Math.min(howManyToDelete, howManyToInsert);\n    for (var j = startIndex; j < startIndex + howManyToSet; j++) {\n        this.set(j, itemsToInsert[j - startIndex]);\n    }\n\n    if (howManyToDelete === howManyToInsert) return;\n\n    var args;\n    if (howManyToDelete > howManyToInsert) {\n        args = [startIndex + howManyToInsert, howManyToDelete - howManyToInsert];\n        Array.prototype.splice.apply(this.__data, args);\n    } else {\n        args = [startIndex + howManyToDelete, 0].concat(itemsToInsert.slice(howManyToDelete));\n        Array.prototype.splice.apply(this.__data, args);\n    }\n    this.dispatchEvent.apply(this, ['splice'].concat(args));\n};\n\nOArray.prototype.forEach = function (fn) {\n    for (var i = 0; i < this.length; i++) {\n        var r = fn(this.get(i), i);\n        if (r === false) break;\n    }\n};\n\n['reverse', 'sort'].forEach(function (f) {\n    OArray.prototype[f] = function () {\n        var r = Util.clone(this.__data);\n        Array.prototype[f].apply(r, arguments);\n        for (var i = 0; i < this.length; i++) {\n            this.set(i, r[i]);\n        }\n    };\n});\n\n['slice', 'concat', 'filter', 'map', 'reduce',\n    'indexOf', 'find', 'findIndex', 'fill', 'join'].forEach(function (f) {\n    OArray.prototype[f] = function () {\n        return Array.prototype[f].apply(this.toArray(), arguments);\n    };\n});\n\nexport default OArray\n","import * as Util from './Util'\nimport OArray from './OArray'\n\nvar Store = {};\nvar Dnstreams = {};\nvar ResultsIn = {};\nvar Upstreams = {};\nvar ResultsFrom = {};\nvar Laziness = {};\nvar PropKernelTable = {};\nvar KernelStatus = {};\nvar GetterSetter = {};\n\nfunction defineProperty(target, prop, desc, proppath) {\n    if (!Util.isNode(target)) {\n        if (Util.isInstance(target, OArray)) {\n            if (desc.set) {\n                target.on('set', function (oval, nval, i, arr) {\n                    if (i == prop) {\n                        desc.set(nval);\n                    }\n                });\n            }\n        } else {\n            Object.defineProperty(target, prop, desc);\n        }\n    } else {\n        if ('value' in desc) {\n            target[prop] = desc.value;\n        }\n        proppath = proppath || fullpathOf(prop, target);\n        if (!GetterSetter[proppath] && ('get' in desc || 'set' in desc)) GetterSetter[proppath] = {};\n        if ('get' in desc) {\n            GetterSetter[proppath].get = desc.get;\n        }\n        if ('set' in desc) {\n            GetterSetter[proppath].set = desc.set;\n        }\n    }\n}\n\nfunction fullpathOf(ref, root) {\n    if (root === undefined) return ref;\n    var pre = register(root);\n    if (pre == null) return ref || '';\n    return pre + (ref ? ('.' + ref) : '');\n}\n\nfunction register(root) {\n    if (root === Store || (!Util.isObject(root) && !Util.isNode(root))) return null;\n    if (!root.__kernel_root) {\n        var id = 'kr_' + Util.gid();\n        defineProperty(root, '__kernel_root', {\n            value: id\n        });\n        Store[id] = root;\n    }\n    return root.__kernel_root;\n}\n\nfunction formatStream(stream, root) {\n    if (Util.isObject(stream) || Util.isString(stream)) stream = [stream];\n    if (Util.isArray(stream)) {\n        return stream.map(function (a) {\n            if (Util.isObject(a)) return register(a.root) + '.' + a.alias;\n            if (Util.isString(a)) return register(root) + '.' + a;\n            return null;\n        });\n    }\n    return [];\n}\n\nfunction propKernelOrder(proppath) {\n    if (PropKernelTable[proppath] === undefined) return 0;\n    return PropKernelTable[proppath].length;\n}\n\n/**\n * Kernel constructor function.\n * @constructor\n */\nfunction Kernel(root, path, relations) {\n    var obj = {};\n    var value;\n    obj = scopeOf(path, root);\n    if (obj == null) return;\n    value = obj.target[obj.property];\n\n    var proppath = register(root) + '.' + path;\n    var __kid = proppath + '#' + propKernelOrder(proppath);\n    defineProperty(this, '__kid', {\n        value: __kid\n    });\n    KernelStatus[this.__kid] = 1;\n    if (PropKernelTable[proppath] === undefined) {\n        PropKernelTable[proppath] = [];\n        if (Util.hasProperty(obj.target, obj.property) && !Util.isInstance(obj.target, OArray)) {\n            delete obj.target[obj.property];\n        }\n    }\n    PropKernelTable[proppath].push(1);\n\n    var dnstream = formatStream(relations.dnstream, root);\n    var resultIn = relations.resultIn;\n    var upstream = formatStream(relations.upstream, root);\n    var resultFrom = relations.resultFrom;\n    var lazy = !!relations.lazy;\n    if (!Dnstreams[proppath]) Dnstreams[proppath] = {};\n    dnstream.forEach(function (p) {\n        if (!Upstreams[p]) Upstreams[p] = {};\n        if (!Upstreams[p][proppath]) Upstreams[p][proppath] = {};\n        Upstreams[p][proppath][__kid] = 1;\n        if (!Dnstreams[proppath][p]) Dnstreams[proppath][p] = {};\n        Dnstreams[proppath][p][__kid] = 1;\n    });\n    if (!ResultsIn[proppath]) ResultsIn[proppath] = [];\n    ResultsIn[proppath].push(Util.isFunction(resultIn) ? resultIn : null);\n    if (!Upstreams[proppath]) Upstreams[proppath] = {};\n    upstream.forEach(function (p) {\n        if (!Upstreams[proppath][p]) Upstreams[proppath][p] = {};\n        Upstreams[proppath][p][__kid] = 1;\n        if (!Dnstreams[p]) Dnstreams[p] = {};\n        if (!Dnstreams[p][proppath]) Dnstreams[p][proppath] = {};\n        Dnstreams[p][proppath][__kid] = 1;\n    });\n    if (Util.isFunction(resultFrom)) {\n        ResultsFrom[proppath] = {\n            f: resultFrom,\n            k: this.__kid,\n            deps: upstream\n        };\n    }\n    if (lazy) Laziness[proppath] = true;\n\n    if (PropKernelTable[proppath].length === 1) {\n        defineProperty(obj.target, obj.property, {\n            get: function () {\n                if (ResultsFrom[proppath] && KernelStatus[ResultsFrom[proppath].k] !== 0) {\n                    var v = ResultsFrom[proppath].f.apply(\n                        null,\n                        ResultsFrom[proppath].deps.map(function (p) { return Data(null, p); })\n                    );\n                    Data(null, proppath, v);\n                    value = v;\n                }\n                return value;\n            },\n            set: function (val, force) {\n                if (!force && val === value) return;\n                if (val !== value) {\n                    if (Util.isInstance(obj.target, OArray) && \n                        !(Util.isObject(value) && Util.isObject(val))) {\n                        obj.target.set(obj.property, val);\n                        value = obj.target[obj.property];\n                    } else {\n                        value = Util.extend(value, val);\n                    }\n                }\n\n                ResultsIn[proppath] && ResultsIn[proppath].forEach(function (f, k) {\n                    f && (KernelStatus[proppath + '#' + k] !== 0) && f.apply(root, [value]);\n                });\n                if (Dnstreams[proppath]) {\n                    Util.each(Dnstreams[proppath], function (kmap, ds) {\n                        var toUpdateDnstream = false;\n                        Util.each(kmap, function (v, k) {\n                            if (KernelStatus[k] !== 0) {\n                                toUpdateDnstream = true;\n                                return false;\n                            }\n                        });\n                        toUpdateDnstream && ResultsFrom[ds] && !Laziness[ds] && Data(null, ds);\n                    });\n                }\n            },\n            // configurable: true,\n            enumerable: true\n        }, proppath);\n    }\n\n    if (Util.hasProperty(relations, 'value')) {\n        Data(null, proppath, relations.value);\n    }\n}\n\nKernel.prototype.disable = function () {\n    KernelStatus[this.__kid] = 0;\n};\nKernel.prototype.enable = function () {\n    KernelStatus[this.__kid] = 1;\n};\nKernel.prototype.destroy = function () {};\n\n/**\n * Whether an object is a relation definition.\n * @param {Object} obj \n * @return {Boolean}\n */\nfunction isRelationDefinition(obj) {\n    if (!Util.isObject(obj)) return false;\n    var r = true;\n    var specProps = {\n        __isRelation: 2, // !\n        dnstream: 1, // *\n        resultIn: 1, // *\n        upstream: 1, // *\n        resultFrom: 1, // *\n        lazy: true,\n        value: true\n    };\n    var count = 0;\n    Util.each(obj, function (v, p) {\n        if (specProps[p] === 2) {\n            r = true;\n            count++;\n            return false;\n        }\n        if (!specProps[p]) {\n            r = false;\n            return false;\n        }\n        if (specProps[p] === 1) {\n            count++;\n        }\n    });\n    return r && (count > 0);\n}\n\n/**\n * Define and bind data with relations in a whole (PropertyPath => Relation) map.\n * @param {Object} obj                  The data object. If `relations` is undefined, it contains relations.\n * @param {Object|Undefined} relations  A map from propertyPath to relation.\n */\nfunction Relate(obj, relations) {\n    var fr;\n    if (arguments.length === 1) {\n        if (!Util.isObject(obj)) return null;\n        fr = Util.flatten(obj, isRelationDefinition, true);\n    } else if (Util.isObject(relations)) {\n        fr = Util.flatten(relations, isRelationDefinition, true);\n    } else {\n        return null;\n    }\n    Util.each(fr, function (rel, p) {\n        new Kernel(obj, p, rel);\n    });\n\n    return obj;\n}\n\n/**\n * Get the target and property.\n * @param {String} ref \n * @param {Object} root \n */\nfunction scopeOf(ref, root) {\n    if (root === undefined) root = Store;\n    if ((!Util.isObject(root) && !Util.isNode(root)) || !Util.isString(ref)) return null;\n    var fullpath = fullpathOf(ref, root);\n    var lastDot = fullpath.lastIndexOf('.');\n    return {\n        target: Data(null, fullpath.substring(0, lastDot)),\n        property: fullpath.substring(lastDot + 1)\n    };\n}\n\nfunction assign(proppath, src, obj) {\n    obj = obj || Data(null, proppath);\n    Util.each(src, function (v, p) {\n        var pp = proppath + '.' + p;\n        if (!Util.hasProperty(obj, p) || Util.isBasic(obj[p]) || Util.isBasic(v)) {\n            Data(null, pp, Util.clone(v));\n        } else {\n            assign(pp, v, obj[p]);\n        }\n    });\n}\n\n/**\n * Get or set data, and trigger getters or setters.\n */\nfunction Data(root, refPath, value) {\n    root = root || Store;\n    var toSet = arguments.length >= 3;\n    var v = root;\n    var proppath = fullpathOf(null, root);\n    var paths = [];\n    if (refPath) paths = refPath.split('.');\n    var p;\n\n    while (paths.length) {\n        if (Util.isBasic(v)) return undefined;\n        p = paths.shift();\n        proppath += (proppath === '' ? '' : '.') + p;\n        if (toSet && paths.length === 0) { /* set */ // TODO\n            if (Util.isInstance(v, OArray) && \n                !(Util.isObject(v[p]) && Util.isObject(value))) {\n                v.set(p, value);\n            } else {\n                v[p] = Util.extend(v[p], value);\n            }\n        } else { /* get */\n            v = v[p];\n        }\n    }\n    return toSet ? v[p] : v;\n}\n\nexport { Kernel, Relate, Data }\n","import * as Util from './Util'\nimport { Data } from './Kernel'\nimport OArray from './OArray'\n\n/**\n * Default configurations.\n * @type {Object}\n */\nvar conf = {\n    attrPrefix: 'm-',\n    refBeginsWithDollar: true,\n    attrsFlag: 'attrs.'\n};\n\nvar domProp = {\n    'value': 'value',\n    'checked': 'checked',\n    'innertext': 'innerText',\n    'innerhtml': 'innerHTML',\n    'class': 'className',\n    'style': 'style.cssText'\n};\n\n/**\n * Regular expressions.\n */\nvar Regs = {\n    assign1: /(\\$[a-zA-Z$_][0-9a-zA-Z$_]*)\\s*=[^=]/g,\n    each11: /^\\s*(\\$([a-zA-Z$_][0-9a-zA-Z$_]*))\\s+in\\s+(\\$([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[a-zA-Z$_][0-9a-zA-Z$_]*)*)\\s*$/,\n    each12: /^\\s*\\(\\s*(\\$([a-zA-Z$_][0-9a-zA-Z$_]*))\\s*,\\s*(\\$([a-zA-Z$_][0-9a-zA-Z$_]*))\\s*\\)\\s+in\\s+(\\$([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[a-zA-Z$_][0-9a-zA-Z$_]*)*)\\s*$/,\n    each21: /^\\s*(([a-zA-Z$_][0-9a-zA-Z$_]*))\\s+in\\s+(([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[a-zA-Z$_][0-9a-zA-Z$_]*)*)\\s*$/,\n    each22: /^\\s*\\(\\s*(([a-zA-Z$_][0-9a-zA-Z$_]*))\\s*,\\s*(([a-zA-Z$_][0-9a-zA-Z$_]*))\\s*\\)\\s+in\\s+(([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[a-zA-Z$_][0-9a-zA-Z$_]*)*)\\s*$/\n};\n\n/**\n * Execute a function with a data object as the scope.\n * @param {String} expr \n * @param {Array} refs \n * @param {*} target \n */\nfunction executeFunctionWithScope(expr, refs, target) {\n    if (conf.refBeginsWithDollar) {\n        expr = expr.replace(Regs.assign1, function (match, p1) {\n            return match.replace(p1, 'this.' + p1.substr(1));\n        });\n    }\n\n    if (Util.isArray(refs)) {\n        if (!target) target = refs[refs.length - 1];\n    } else {\n        refs = [refs];\n        if (!target) target = refs[0];\n    }\n    \n    var ref = {};\n    Util.each(refs, function (r) {\n        Util.each(r, function (v, p) {\n            if (p in ref) return;\n            ref[p] = v;\n        });\n    });\n\n    var params = Object.keys(ref);\n    if (conf.refBeginsWithDollar) {\n        params = params.map(function (r) {\n            return '$' + r;\n        });\n    }\n    var args = Object.values(ref);\n    // Util.each(args, function (v, i) {\n    //     if (Util.isFunction(v)) {\n    //         args[i] = v.bind(ref);\n    //     }\n    // });\n    return (new Function(params.join(','), 'return (' + expr + ')')).apply(target, args);\n}\n\n/**\n * Evaluate an expression with a data object.\n * @param {String} expr \n * @param {Array} refs \n * @return {*}\n */\nfunction evaluateExpression(expr, refs) {\n    expr = replaceTmplInStrLiteral(expr);\n    var result = null;\n    try {\n        result = executeFunctionWithScope(expr, refs);\n    } catch (e) {}\n    return result;\n}\n\n/**\n * Fix template strings in a string literal to JavaScript string-concat expressions.\n * @param {String} str \n * @return {String}\n * @example \"'My name is {{name}}.'\" => \"'My name is ' + (name) + '.'\"\n */\nfunction replaceTmplInStrLiteral(str) {\n    var reg = /{{([^{}]*)}}/g;\n    return str.replace(reg, function (match, p1) {\n        return '\\' + (' + p1 + ') + \\'';\n    });\n}\n\n/**\n * Evaluate a raw text with template expressions.\n * @param {String} text \n * @param {Array} refs \n * @return {String}\n * @example ('My name is {{$name}}.', { name: 'Tom' }) => 'My name is Tom.'\n */\nfunction evaluateRawTextWithTmpl(text, refs) {\n    var reg = /{{([^{}]*)}}/g;\n    var result = text.replace(reg, function (match, p1) {\n        return executeFunctionWithScope(p1, refs);\n    });\n    return result;\n}\n\n/**\n * Parse reference paths from an expression string.\n * @param {String} expr \n * @return {Array<String>}\n */\nfunction parseRefsInExpr(expr) {\n    expr = ';' + expr + ';';\n    var reg;\n    if (conf.refBeginsWithDollar) {\n        reg = /\\$([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[a-zA-Z$_][0-9a-zA-Z$_]*)*/g;\n        return expr.match(reg).map(function (r) {\n            return r.substr(1);\n        });\n    } else {\n        reg = /([a-zA-Z$_][0-9a-zA-Z$_]*)(\\.[a-zA-Z$_][0-9a-zA-Z$_]*)*/g;\n        return expr.match(reg);\n    }\n}\n\n/**\n * Parse `each` template expression from an attribute value string.\n * @param {String} expr \n * @param {Array} refs\n */\nfunction parseEachExpr(expr, refs) {\n    var valStr;\n    var keyStr;\n    var targetStr;\n    var r;\n    if (conf.refBeginsWithDollar) {\n        r = Regs.each12.exec(expr);\n        if (r) {\n            valStr = r[1].substr(1);\n            keyStr = r[3].substr(1);\n            targetStr = r[5].substr(1);\n        } else {\n            r = Regs.each11.exec(expr);\n            valStr = r[1].substr(1);\n            targetStr = r[3].substr(1);\n        }\n    } else {\n        r = Regs.each22.exec(expr);\n        if (r) {\n            valStr = r[1];\n            keyStr = r[3];\n            targetStr = r[5];\n        } else {\n            r = Regs.each21.exec(expr);\n            valStr = r[1];\n            targetStr = r[3];\n        }\n    }\n    var root = Util.seekTarget(targetStr, refs);\n    var value = Data(root, targetStr);\n    if (!(value instanceof OArray)) {\n        value = new OArray(value);\n        Data(root, targetStr, value);\n    }\n    return {\n        target: value,\n        targetRef: targetStr,\n        iterator: {\n            val: valStr,\n            key: keyStr\n        }\n    };\n}\n\n/**\n * Parse template expression strings from a raw text such as a text node value.\n * @param {String} text     [description]\n * @return {Array<String>}  [description]\n * @example 'My name is {{$name}}. I\\'m {{$age}} years old.' => ['$name', '$age']\n */\nfunction parseExprsInRawText(text) {\n    var reg = /{{([^{}]*)}}/g;\n    var exprs = [];\n    text.replace(reg, function (match, p1) {\n        exprs.push(p1);\n        return '';\n    });\n    return exprs;\n}\n\n/**\n * Get relations from an expression string to the data, and apply in time as well.\n * @param {String}      expr \n * @param {Array}       refs \n * @param {Function}    resultFrom \n * @return {Object}\n */\nfunction relationFromExprToRef(expr, refs, target, proppath, resultFrom) {\n    if (!Util.isArray(refs)) refs = [refs];\n\n    function getAllRefs(expr, refs) {\n        var refsInExpr = parseRefsInExpr(expr);\n        var subData = {};\n        Util.each(refsInExpr, function (r) {\n            var i = Util.seekTargetIndex(r, refs);\n            if (!subData[i]) subData[i] = {};\n            subData[i][r] = Data(refs[i], r);\n        });\n        var re = [];\n        Util.each(subData, function (s, i) {\n            re.push({\n                target: refs[i],\n                refs: Util.allRefs(s)\n            });\n        });\n        return re;\n    }\n\n    var targetIsNode = Util.isNode(target);\n    var resultIn = function () {\n        var result = (resultFrom || function () {\n            return evaluateExpression(expr, refs);\n        })();\n\n        /* Transformation */\n        if (targetIsNode && proppath === 'className') {\n            var classList = [];\n            if (Util.isObject(result)) {\n                Util.each(result, function (v, p) {\n                    v && classList.push(p);\n                });\n            } else if (Util.isArray(result)) {\n                Util.each(result, function (v) {\n                    if (Util.isString(v)) classList.push(v);\n                    else if (Util.isObject(v)) {\n                        Util.each(v, function (vv, pp) {\n                            vv && classList.push(pp);\n                        });\n                    }\n                });\n            }\n            result = classList.join(' ');\n        } else if (targetIsNode && proppath === 'style.cssText') {\n            var stylePairs = [];\n            if (Util.isObject(result)) {\n                Util.each(result, function (v, p) {\n                    stylePairs.push(p + ':' + v);\n                });\n            }\n            result = stylePairs.join(';');\n        }\n\n        if (targetIsNode && proppath.startsWith(conf.attrsFlag)) {\n            if (result != null) {\n                var attrName = proppath.substr(conf.attrsFlag.length);\n                target.setAttribute(attrName, result);\n            }\n        } else {\n            Data(target, proppath, result);\n        }\n    };\n\n    var r = getAllRefs(expr, refs).map(function (a) {\n        return {\n            target: a.target,\n            relations: (function () {\n                var r = {};\n                a.refs.forEach(function (refpath) {\n                    r[refpath] = {\n                        resultIn: resultIn\n                    };\n                });\n                return r;\n            })()\n        };\n    });\n    resultIn();\n    return r;\n}\n\nexport {\n    conf,\n    domProp,\n    relationFromExprToRef,\n    executeFunctionWithScope,\n    parseExprsInRawText,\n    evaluateRawTextWithTmpl,\n    parseEachExpr\n}\n","import * as Util from './Util'\nimport { Kernel, Relate, Data } from './Kernel'\nimport * as Parser from './Parser'\n\n/**\n * Default configurations.\n * @type {Object}\n */\nvar conf = {\n    domBoundFlag: '__dmd_bound',\n    domListKey: '__dmd_key'\n};\n\nfunction pathContains(path, ref) {\n    Util.each(ref, function (p, k) {\n        if (path === k || path.startsWith(k + '.')) return k;\n    });\n    return null;\n}\n\nvar domValueToBind = {\n    'input': true,\n    'select': true\n};\n\n/**\n * Bind data to DOM.\n * @param  {HTMLElement} $el            [description]\n * @param  {Object} ref                 [description]\n * @param  {Array} ext                  [description]\n * @return {[type]}                     [description]\n */\nfunction Bind($el, ref, ext) {\n    if (!Util.isNode($el) || !Util.isObject(ref)) return null;\n    ext = ext ? (Util.isArray(ext) ? ext : [ext]) : []; /* Ensure `ext` is an array */\n    var scopes = ext.concat(ref);\n\n    if ($el.nodeType === Node.ELEMENT_NODE && !$el[conf.domBoundFlag]) {\n        $el[conf.domBoundFlag] = true; /* Set a binding flag. */\n\n        /* Bind a list */\n        if ($el.hasAttribute(Parser.conf.attrPrefix + 'each')) {\n            var eachAttrName = Parser.conf.attrPrefix + 'each';\n            var eachExprText = $el.getAttribute(eachAttrName);\n            var eachExpr = Parser.parseEachExpr(eachExprText, ref);\n            $el.removeAttribute(eachAttrName);\n            var $parent = $el.parentNode;\n            $parent.removeChild($el);\n\n            var $targetList = eachExpr.target;\n\n            function bindItem(v, k) {\n                var $copy = $el.cloneNode(true);\n                var _ext = {};\n                _ext[eachExpr.iterator.val] = v;\n                _ext[eachExpr.iterator.key] = k;\n                Bind($copy, ref, [_ext].concat(ext));\n                $parent.appendChild($copy);\n\n                $targetList.on({\n                    push: function (v) {},\n                    unshift: function (v) {},\n                    pop: function () {},\n                    shift: function () {},\n                    splice: function (startIndex, howManyDeleted, itemInserted) {},\n                    set: function (oval, nval, i, arr) {\n                        if (i == k) {\n                            console.log('set', i, nval);\n                            _ext[eachExpr.iterator.val] = nval;\n                        }\n                    }\n                });\n            }\n\n            Util.each($targetList, bindItem);\n\n            $targetList.on({\n                push: function (v) {\n                    console.log('push', v, $targetList.length - 1);\n                    bindItem(v, $targetList.length - 1);\n                },\n                unshift: function (v) {},\n                pop: function () {},\n                shift: function () {},\n                splice: function (startIndex, howManyDeleted, itemInserted) {},\n                set: function (oval, nval, i, arr) {}\n            });\n        }\n        \n        /* Bind child nodes recursively */\n        Util.each($el, function (node) {\n            Bind(node, ref, ext);\n        });\n\n        var attrList = [];\n        Util.each($el.attributes, function (value, name) {\n            if (!name.startsWith(Parser.conf.attrPrefix)) return;\n            attrList.push(name);\n            name = name.substr(Parser.conf.attrPrefix.length).toLowerCase();\n\n            var eventName = Util.isEventName(name);\n            if (eventName) { /* Event */\n                Util.addEvent($el, eventName, function (e) {\n                    Parser.executeFunctionWithScope(value, [{\n                        e: e\n                    }].concat(scopes));\n                }, true);\n                return;\n            }\n\n            if (domValueToBind[$el.nodeName.toLowerCase()] && name === 'value') { /* Two-way binding */\n                var valueProp = Parser.conf.refBeginsWithDollar ? value.substr(1) : value;\n                var valueTarget = Util.seekTarget(valueProp, ext, ref);\n                Util.addEvent($el, 'input', function (e) {\n                    Data(valueTarget, valueProp, this.value);\n                }, false);\n            }\n\n            if (Parser.domProp[name]) name = Parser.domProp[name];\n            else name = Parser.conf.attrsFlag + name; /* Attribute */\n\n            /* Binding */\n            var allrel = Parser.relationFromExprToRef(value, scopes, $el, name);\n            allrel.forEach(function (a) {\n                Relate(a.target, a.relations);\n            });\n        });\n\n        /* Clean attributes */\n        Util.each(attrList, function (name) {\n            $el.removeAttribute(name);\n        });\n    } else if ($el.nodeType === Node.TEXT_NODE) {\n        var tmpl = $el.nodeValue;\n        var expr = Parser.parseExprsInRawText(tmpl).join(';');\n        if (expr === '') return null;\n\n        /* Binding */\n        var allrel;\n        var $targetEl = $el;\n        var targetRef = 'nodeValue';\n        if ($el.parentNode.nodeName.toLowerCase() === 'textarea') {\n            $targetEl = $el.parentNode;\n            targetRef = 'value';\n        }\n        allrel = Parser.relationFromExprToRef(expr, scopes, $targetEl, targetRef, function () {\n            return Parser.evaluateRawTextWithTmpl(tmpl, scopes);\n        });\n        allrel.forEach(function (a) {\n            Relate(a.target, a.relations);\n        });\n    }\n\n    return $el;\n}\n\n/**\n * Unbind data from DOM.\n * @param       {[type]} $el      [description]\n * @param       {[type]} ref      [description]\n * @param       {[type]} relation [description]\n * @constructor\n */\nfunction Unbind($el, ref, relation) {\n    // TODO\n}\n\n/**\n * Constructor.\n * @param {*} $el \n * @param {*} ref \n */\nvar DMD = function ($el, ref) {\n    Bind.call(this, $el, ref);\n};\n\nDMD.kernel = Kernel;\nDMD.relate = Relate;\nDMD.$ = Data;\n\nexport default DMD\n"],"names":["addEvent","$el","eventName","handler","useCapture","addEventListener","attachEvent","flatten","root","objectFilter","clean","ext","each","v","p","isObject","f","vv","pp","defineProperty","target","prop","desc","Object","value","OArray","arr","option","Util.isObject","arguments","length","Util.isArray","this","get","set","_this","eventNames","forEach","e","Util.each","i","assignElement","proppath","Util.isNode","fullpathOf","GetterSetter","Util.isInstance","on","oval","nval","ref","undefined","pre","register","Store","__kernel_root","id","Util.gid","formatStream","stream","Util.isString","map","a","alias","propKernelOrder","PropKernelTable","Kernel","path","relations","obj","scopeOf","property","__kid","KernelStatus","Util.hasProperty","push","dnstream","resultIn","upstream","resultFrom","lazy","Dnstreams","Upstreams","ResultsIn","Util.isFunction","ResultsFrom","k","deps","Laziness","apply","Data","val","force","Util.extend","kmap","ds","toUpdateDnstream","enumerable","isRelationDefinition","r","specProps","__isRelation","count","Relate","fr","Util.flatten","rel","fullpath","lastDot","lastIndexOf","substring","refPath","toSet","paths","split","Util.isBasic","shift","executeFunctionWithScope","expr","refs","conf","refBeginsWithDollar","replace","Regs","assign1","match","p1","substr","params","keys","args","values","Function","join","evaluateExpression","replaceTmplInStrLiteral","result","str","reg","evaluateRawTextWithTmpl","text","parseRefsInExpr","parseEachExpr","valStr","keyStr","targetStr","each12","exec","each11","each22","each21","Util.seekTarget","targetRef","iterator","key","parseExprsInRawText","exprs","relationFromExprToRef","targetIsNode","classList","stylePairs","startsWith","attrsFlag","attrName","setAttribute","refsInExpr","subData","Util.seekTargetIndex","re","s","Util.allRefs","getAllRefs","refpath","Bind","scopes","concat","nodeType","Node","ELEMENT_NODE","domBoundFlag","TEXT_NODE","tmpl","nodeValue","Parser.parseExprsInRawText","$targetEl","parentNode","nodeName","toLowerCase","Parser.relationFromExprToRef","Parser.evaluateRawTextWithTmpl","hasAttribute","Parser.conf","attrPrefix","eachAttrName","eachExpr","Parser.parseEachExpr","getAttribute","removeAttribute","$parent","removeChild","$targetList","bindItem","$copy","cloneNode","_ext","appendChild","unshift","pop","splice","startIndex","howManyDeleted","itemInserted","console","log","node","attrList","attributes","name","Util.isEventName","Util.addEvent","Parser.executeFunctionWithScope","domValueToBind","valueProp","valueTarget","Parser.domProp","gid","n","isNumber","isNumeric","parseInt","isNaN","isString","isFunction","prototype","toString","call","isArray","isBasic","isInstance","creator","isNode","isNamedNodeMap","NamedNodeMap","isEventName","func","arrayReverse","len","hasOwnProperty","ret","COMMENT_NODE","PROCESSING_INSTRUCTION_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","childNodes","clone","hasProperty","clear","withBasicVal","inRef","shrinkArray","extend","dest","srcs","extendObj","src","argOffset","lastArg","Array","slice","allRefs","hasRef","seekTarget","seekTargetIndex","roots","index","constructor","hdl","evt","removeEventListener","handlers","h","off","dispatchEvent","trigger","__data","configurable","deleteElement","toArray","notClone","Util.clone","howManyToDelete","itemToInsert","Util.isNumber","itemsToDelete","itemsToInsert","howManyToInsert","howManyToSet","Math","min","j","fn","disable","enable","destroy","domProp","checked","innertext","innerhtml","class","style","domListKey","input","select","DMD","kernel","relate","$"],"mappings":"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"}