{"version":3,"file":"Kernel.js","sources":["../src/Util.js","../src/Kernel.js"],"sourcesContent":["var gid = (function () {\r\n    var n = 0;\r\n    return function () {\r\n        return n++;\r\n    };\r\n})();\r\n\r\nvar isBoolean = function (v) {\r\n    return typeof v === 'boolean';\r\n};\r\n\r\nvar isNumber = function (v) {\r\n    return typeof v === 'number';\r\n};\r\n\r\nvar isNumeric = function (v) {\r\n    var n = parseInt(v);\r\n    if (isNaN(n)) return false;\r\n    return (typeof v === 'number' || typeof v === 'string') && n == v;\r\n};\r\n\r\nvar isString = function (v) {\r\n    return typeof v === 'string';\r\n};\r\n\r\nvar isFunction = function (v) {\r\n    return typeof v === 'function';\r\n};\r\n\r\nvar isObject = function (v) {\r\n    return Object.prototype.toString.call(v) === '[object Object]';\r\n};\r\n\r\nvar isArray = function (v) {\r\n    return Object.prototype.toString.call(v) === '[object Array]';\r\n};\r\n\r\nvar isBasic = function (v) {\r\n    return v == null\r\n        || typeof v === 'boolean'\r\n        || typeof v === 'number'\r\n        || typeof v === 'string'\r\n        || typeof v === 'function';\r\n};\r\n\r\nvar isInstance = function (v, creator) {\r\n    return typeof creator === 'function' && v instanceof creator;\r\n};\r\n\r\nvar isDirectInstance = function (v, creator) {\r\n    return v.constructor === creator;\r\n};\r\n\r\nvar isNode = function (v) {\r\n    return v instanceof Node;\r\n};\r\n\r\nvar isNamedNodeMap = function (v) {\r\n    return v instanceof NamedNodeMap;\r\n};\r\n\r\nvar isEventName = function (v) {\r\n    if (!isString(v)) return false;\r\n    return v.startsWith('on'); // TODO\r\n};\r\n\r\nvar isCSSSelector = function (v) {\r\n    return v.indexOf(' ') > 0 || v.indexOf('.') >= 0\r\n        || v.indexOf('[') >= 0 || v.indexOf('#') >= 0;\r\n};\r\n\r\nvar each = function (v, func, arrayReverse) {\r\n    if (isObject(v)) {\r\n        for (var p in v) {\r\n            if (!v.hasOwnProperty(p)) continue;\r\n            var r = func(v[p], p);\r\n            if (r === false) break;\r\n        }\r\n    } else if (isArray(v)) {\r\n        if (!arrayReverse) {\r\n            for (var i = 0, len = v.length; i < len; i++) {\r\n                var r = func(v[i], i);\r\n                if (r === false) break;\r\n            }\r\n        } else {\r\n            for (var i = v.length - 1; i >= 0; i--) {\r\n                var r = func(v[i], i);\r\n                if (r === false) break;\r\n            }\r\n        }\r\n    } else if (isNode(v)) {\r\n        var ret = false;\r\n        switch (v.nodeType) {\r\n            case Node.ELEMENT_NODE:\r\n                break;\r\n            case Node.TEXT_NODE:\r\n            case Node.COMMENT_NODE:\r\n            case Node.PROCESSING_INSTRUCTION_NODE:\r\n            case Node.DOCUMENT_NODE:\r\n            case Node.DOCUMENT_TYPE_NODE:\r\n            case Node.DOCUMENT_FRAGMENT_NODE:\r\n            default:\r\n                ret = true;\r\n        }\r\n        if (ret) return;\r\n        for (var i = 0, childNodes = v.childNodes, len = v.childNodes.length; i < len; i++) {\r\n            func(childNodes[i]);\r\n            each(childNodes[i], func);\r\n        }\r\n    } else if (isNamedNodeMap(v)) {\r\n        for (var i = 0, len = v.length; i < len; i++) {\r\n            var r = func(v[i]['nodeValue'], v[i]['nodeName']);\r\n            if (r === false) break;\r\n        }\r\n    } else if (Util.isFunction(v.forEach)) {\r\n        v.forEach(func);\r\n    }\r\n};\r\n\r\nvar eachUnique = function (arr, func) {\r\n    if (!isArray(arr)) return;\r\n    var map = {};\r\n    for (var i = 0, len = arr.length; i < len; i++) {\r\n        if (!isNumber(arr[i]) || !isString(arr[i]) || map[arr[i]]) continue;\r\n        map[arr[i]] = true;\r\n        var r = func(arr[i]);\r\n        if (r === false) break;\r\n    }\r\n};\r\n\r\nvar unique = function (arr) {\r\n    var r = [];\r\n    eachUnique(arr, function (v) {\r\n        r.push(v);\r\n    });\r\n    return r;\r\n};\r\n\r\nvar clone = function (val) {\r\n    var r = val;\r\n    if (isObject(val)) {\r\n        r = {};\r\n        each(val, function (v, p) {\r\n            r[p] = clone(v);\r\n        });\r\n    } else if (isArray(val)) {\r\n        r = [];\r\n        each(val, function (v) {\r\n            r.push(clone(v));\r\n        });\r\n    }\r\n    return r;\r\n};\r\n\r\nvar hasProperty = function (val, p) {\r\n    if (isObject(val)) {\r\n        return val.hasOwnProperty(p);\r\n    } else if (isArray(val)) {\r\n        var n = parseInt(p);\r\n        return isNumeric(p) && val.length > n && n >= 0;\r\n    }\r\n    return false;\r\n};\r\n\r\nvar clear = function (val, p, withBasicVal) {\r\n    var inRef = isString(p) || isNumber(p);\r\n    var target = inRef ? val[p] : val;\r\n\r\n    if (isObject(target) || isArray(target)) {\r\n        each(target, function (v, p) {\r\n            clear(target, p);\r\n        });\r\n        if (isArray(target)) {\r\n            shrinkArray(target);\r\n        }\r\n    }\r\n\r\n    if (inRef) {\r\n        val[p] = withBasicVal;\r\n    }\r\n};\r\n\r\nvar shrinkArray = function (arr, len) {\r\n    var limited = isNumber(len);\r\n    if (!limited) {\r\n        each(arr, function (v, i) {\r\n            if (v === undefined) arr.length--;\r\n        }, true);\r\n    } else {\r\n        each(arr, function (v, i) {\r\n            if (i >= len) arr.length--;\r\n            else return false;\r\n        }, true);\r\n        while (arr.length < len) {\r\n            arr.push(null);\r\n        }\r\n    }\r\n    return arr;\r\n};\r\n\r\nvar touchLeaves = function (obj) {\r\n    each(obj, function (v, p) {\r\n        if (isBasic(v)) {\r\n            obj[p] = v;\r\n        } else {\r\n            touchLeaves(v);\r\n        }\r\n    });\r\n};\r\n\r\nvar extend = function (dest, srcs, clean) {\r\n    if (!isObject(dest)) return null;\r\n    var args = Array.prototype.slice.call(arguments, 1,\r\n        arguments[arguments.length - 1] === true ? (arguments.length - 1) : arguments.length);\r\n\r\n    function extendObj(obj, src, clean) {\r\n        if (!isObject(src)) return;\r\n        each(src, function (v, p) {\r\n            if (!hasProperty(obj, p) || isBasic(v)) {\r\n                if (obj[p] !== v) {\r\n                    obj[p] = clone(v);\r\n                }\r\n            } else {\r\n                extendObj(obj[p], v, clean);\r\n            }\r\n        });\r\n        if (clean) {\r\n            each(obj, function (v, p) {\r\n                if (!hasProperty(src, p)) {\r\n                    clear(obj, p);\r\n                }\r\n            });\r\n            if (isArray(obj)) {\r\n                shrinkArray(obj);\r\n            }\r\n        }\r\n    }\r\n\r\n    each(args, function (src) {\r\n        extendObj(dest, src, clean);\r\n    });\r\n    return dest;\r\n};\r\n\r\nexport {\r\n    gid,\r\n    isBoolean,\r\n    isNumber,\r\n    isNumeric,\r\n    isString,\r\n    isFunction,\r\n    isObject,\r\n    isArray,\r\n    isBasic,\r\n    isInstance,\r\n    isDirectInstance,\r\n    isNode,\r\n    isNamedNodeMap,\r\n    isEventName,\r\n    isCSSSelector,\r\n    each,\r\n    eachUnique,\r\n    unique,\r\n    clone,\r\n    hasProperty,\r\n    clear,\r\n    shrinkArray,\r\n    touchLeaves,\r\n    extend\r\n}\r\n","import * as Util from './Util'\r\n\r\nvar Store = {};\r\nvar Dnstreams = {};\r\nvar ResultsIn = {};\r\nvar Upstreams = {};\r\nvar ResultsFrom = {};\r\nvar Laziness = {};\r\nvar PropKernelTable = {};\r\nvar KernelStatus = {};\r\n\r\nfunction get(ref, root) {\r\n    if (root === undefined) root = Store;\r\n    if (!Util.isObject(root) || !Util.isString(ref)) return null;\r\n    var node = root;\r\n    var refs = ref.split('.');\r\n    while (refs.length >= 1) {\r\n        if (refs.length === 1) {\r\n            return {\r\n                target: node,\r\n                property: refs[0]\r\n            };\r\n        }\r\n        node = node[refs.shift()];\r\n        if (!Util.isObject(node)) return null;\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction set(ref, val, root) {\r\n    var obj = get(ref, root);\r\n    if (obj) obj.target[obj.property] = val;\r\n}\r\n\r\nfunction update(ref, root) {\r\n    var obj = get(ref, root);\r\n    if (!obj) return null;\r\n    return obj.target[obj.property];\r\n}\r\n\r\nfunction register(root) {\r\n    if (!Util.isObject(root)) return null;\r\n    if (!root.__kernel_root) {\r\n        var id = 'kr_' + Util.gid();\r\n        Object.defineProperty(root, '__kernel_root', {\r\n            value: id\r\n        });\r\n        Store[id] = root;\r\n    }\r\n    return root.__kernel_root;\r\n}\r\n\r\nfunction formatStream(stream, root) {\r\n    if (Util.isObject(stream) || Util.isString(stream)) stream = [stream];\r\n    if (Util.isArray(stream)) {\r\n        return stream.map(function (a) {\r\n            if (Util.isObject(a)) return register(a.root) + '.' + a.alias;\r\n            if (Util.isString(a)) return register(root) + '.' + a;\r\n            return null;\r\n        });\r\n    } else {\r\n        return [];\r\n    }\r\n}\r\n\r\nfunction propKernelOrder(proppath) {\r\n    if (PropKernelTable[proppath] === undefined) return 0;\r\n    return PropKernelTable[proppath].length;\r\n}\r\n\r\n/**\r\n * Kernel constructor function.\r\n * @constructor\r\n */\r\nfunction Kernel(root, path, relations) {\r\n    var obj = get(path, root);\r\n    if (obj == null) return;\r\n    var proppath = register(root) + '.' + path;\r\n    var __kid = proppath + '#' + propKernelOrder(proppath);\r\n    Object.defineProperty(this, '__kid', {\r\n        value: __kid\r\n    });\r\n    KernelStatus[this.__kid] = 1;\r\n    var value = obj.target[obj.property];\r\n    if (PropKernelTable[proppath] === undefined) {\r\n        PropKernelTable[proppath] = [];\r\n        if (Util.hasProperty(obj.target, obj.property))\r\n            delete obj.target[obj.property];\r\n    }\r\n    PropKernelTable[proppath].push(1);\r\n\r\n    var dnstream = formatStream(relations.dnstream);\r\n    var resultIn = relations.resultIn;\r\n    var upstream = formatStream(relations.upstream);\r\n    var resultFrom = relations.resultFrom;\r\n    var lazy = !!relations.lazy;\r\n    if (Util.hasProperty(relations, 'value')) {\r\n        value = relations.value;\r\n    }\r\n    if (!Dnstreams[proppath]) Dnstreams[proppath] = {};\r\n    dnstream.forEach(function (p) {\r\n        if (!Upstreams[p]) Upstreams[p] = {};\r\n        if (!Upstreams[p][proppath]) Upstreams[p][proppath] = {};\r\n        Upstreams[p][proppath][__kid] = 1;\r\n        if (!Dnstreams[proppath][p]) Dnstreams[proppath][p] = {};\r\n        Dnstreams[proppath][p][__kid] = 1;\r\n    });\r\n    if (!ResultsIn[proppath]) ResultsIn[proppath] = [];\r\n    ResultsIn[proppath].push(Util.isFunction(resultIn) ? resultIn : null);\r\n    if (!Upstreams[proppath]) Upstreams[proppath] = {};\r\n    upstream.forEach(function (p) {\r\n        if (!Upstreams[proppath][p]) Upstreams[proppath][p] = {};\r\n        Upstreams[proppath][p][__kid] = 1;\r\n        if (!Dnstreams[p]) Dnstreams[p] = {};\r\n        if (!Dnstreams[p][proppath]) Dnstreams[p][proppath] = {};\r\n        Dnstreams[p][proppath][__kid] = 1;\r\n    });\r\n    if (Util.isFunction(resultFrom)) ResultsFrom[proppath] = {\r\n        f: resultFrom,\r\n        k: this.__kid\r\n    };\r\n    if (lazy) Laziness[proppath] = true;\r\n\r\n    if (PropKernelTable[proppath].length === 1) {\r\n        Object.defineProperty(obj.target, obj.property, {\r\n            get: function () {\r\n                if (ResultsFrom[proppath] && KernelStatus[ResultsFrom[proppath].k] !== 0) {\r\n                    value = ResultsFrom[proppath].f.apply(Store, upstream.map(function (p) { return update(p) }));\r\n                }\r\n                return value;\r\n            },\r\n            set: function (val) {\r\n                if (val === value) return;\r\n                value = val;\r\n                ResultsIn[proppath] && ResultsIn[proppath].forEach(function (f, k) {\r\n                    f && (KernelStatus[proppath + '#' + k] !== 0) && f.apply(root, [val]);\r\n                });\r\n                if (Dnstreams[proppath]) {\r\n                    Util.each(Dnstreams[proppath], function (kmap, ds) {\r\n                        var toUpdateDnstream = false;\r\n                        Util.each(kmap, function (v, k) {\r\n                            if (KernelStatus[k] !== 0) {\r\n                                toUpdateDnstream = true;\r\n                                return false;\r\n                            }\r\n                        });\r\n                        if (toUpdateDnstream && ResultsFrom[ds] && !Laziness[ds])\r\n                            update(ds);\r\n                    });\r\n                }\r\n            },\r\n            // configurable: true,\r\n            enumerable: true\r\n        });\r\n    }\r\n}\r\n\r\nKernel.prototype.disable = function () {\r\n    KernelStatus[this.__kid] = 0;\r\n};\r\nKernel.prototype.enable = function () {\r\n    KernelStatus[this.__kid] = 1;\r\n};\r\nKernel.prototype.destroy = function () {\r\n    // TODO\r\n};\r\n\r\nfunction isRelationDefinition(obj) {\r\n    if (!Util.isObject(obj)) return false;\r\n    var r = true;\r\n    var specProps = {\r\n        dnstream: 1, // *\r\n        resultIn: 1, // *\r\n        upstream: 1, // *\r\n        resultFrom: 1, // *\r\n        lazy: true,\r\n        value: true\r\n    };\r\n    var count = 0;\r\n    Util.each(obj, function (v, p) {\r\n        if (!specProps[p]) {\r\n            r = false;\r\n            return false;\r\n        } else if (specProps[p] === 1) {\r\n            count++;\r\n        }\r\n    });\r\n    return r && (count > 0);\r\n}\r\n\r\nfunction flatten(root, onlyWantRelation) {\r\n    var ext = {};\r\n    Util.each(root, function (v, p) {\r\n        if (Util.isObject(v) && !isRelationDefinition(v)) {\r\n            var f = flatten(v, onlyWantRelation);\r\n            Util.each(f, function (vv, pp) {\r\n                ext[p + '.' + pp] = vv;\r\n            });\r\n        } else {\r\n            if (!onlyWantRelation || isRelationDefinition(v))\r\n                ext[p] = v;\r\n        }\r\n    })\r\n    return ext;\r\n}\r\n\r\nfunction Relate(obj, relations) {\r\n    var fr;\r\n    if (arguments.length === 1) {\r\n        if (!Util.isObject(obj)) return null;\r\n        fr = flatten(obj, true);\r\n    } else if (Util.isObject(relations)) {\r\n        fr = flatten(relations, true);\r\n    } else {\r\n        return null;\r\n    }\r\n    Util.each(fr, function (rel, p) {\r\n        new Kernel(obj, p, rel);\r\n    });\r\n\r\n    return obj;\r\n}\r\n\r\nexport { Kernel, Relate }\r\n"],"names":["Util.isObject","Util.isString","Util.gid","Util.isArray","Util.hasProperty","Util.isFunction","Util.each"],"mappings":"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"}