{"version":3,"file":"domod.js","sources":["../src/index.js","../src/Polyfill.js","../src/Util.js","../src/AliasDOM.js","../src/ObservableArray.js","../src/DataBinding.js"],"sourcesContent":["import './Polyfill'\nimport * as Util from './Util'\nimport { AliasDOM, Alias } from './AliasDOM'\nimport { BindData, GetBinding, GetData } from './DataBinding'\n\n/* Initialize the reference space. */\nvar DMDRefSpace = BindData();\n\n/**\n * Bind data to DOM.\n * @param  {Object} ref                 [description]\n * @param  {HTMLElement|AliasDOM} $el   [description]\n * @param  {Object} relation            [description]\n * @return {[type]}                     [description]\n * @note   如果有relation，则认为是active模式，否则是passive模式；active模式会主动去\n *         遍历relation的属性进行绑定；passive模式会遍历$el的DOM属性\n */\nfunction Bind(ref, $el, relation) {\n    if (!Util.isObject(ref)) return;\n    BindData(ref);\n\n    var _this = this;\n\n    if (Util.isInstance($el, AliasDOM)) {\n        Util.each($el, function (dom, a) {\n            Bind(ref, dom, relation[a]);\n        });\n        return;\n    }\n\n    if (!Util.isNode($el)) return;\n\n    /**\n     * Get all dependencies and one evaluating function of a relation to the reference data.\n     * @param  {Object} ref         [description]\n     * @param  {String|Array} rel   [description]\n     * @return {Object}             [description]\n     */\n    function depsAndCalc(ref, rel) {\n        var deps = [], calc = function (v) { return v; };\n        if (Util.isString(rel)) {\n            deps.push(rel);\n            calc = function () { return GetData(ref, rel); };\n        } else if (Util.isArray(rel)) {\n            if (Util.isFunction(rel[rel.length - 1])) {\n                calc = rel[rel.length - 1];\n                if (Util.isArray(rel[0])) {\n                    deps = rel[0].slice(0);\n                } else {\n                    deps = rel.filter(function (v) { return Util.isString(v); });\n                }\n            } else {\n                var parts = [];\n                Util.each(rel, function (v) {\n                    if (Util.isString(v)) {\n                        parts.push(v);\n                    } else if (Util.isObject(v)) {\n                        Util.each(v, function (r, p) {\n                            var de = depsAndCalc(ref, r);\n                            deps = deps.concat(de.deps);\n                            var obj = {};\n                            obj[p] = de.calc;\n                            parts.push(obj);\n                        });\n                    }\n                });\n                calc = function () {\n                    var re = [];\n                    Util.each(parts, function (v) {\n                        if (Util.isString(v)) {\n                            re.push(v);\n                        } else if (Util.isObject(v)) {\n                            Util.each(v, function (e, p) {\n                                if (e.call(ref)) re.push(p);\n                                return false;\n                            });\n                        }\n                    });\n                    return re.join('\\n');\n                };\n            }\n        }\n\n        return {\n            deps: deps,\n            calc: calc\n        };\n    }\n\n    /**\n     * Apply a relation upon the reference data.\n     * @param  {Object} ref         [description]\n     * @param  {String|Array} rel   [description]\n     * @param  {Boolean} loop       [description]\n     * @return {Function}           [description]\n     */\n    function applyRelation(ref, rel, loop) {\n        var de = depsAndCalc(ref, rel);\n        var deps = Util.unique(de.deps).map(function (r) { return GetBinding(ref, r); });\n        var calc = de.calc;\n        if (!loop) {\n            return function (relate) {\n                /* Apply the relation now. */\n                relate(calc.call(ref));\n\n                /* Add `relate` as a setter to the deps in `rel`. */\n                Util.each(deps, function (dep) {\n                    dep.setters.push(function (v) {\n                        relate(calc.call(ref, v));\n                    });\n                });\n            };\n        } else {\n            // TODO\n        }\n    }\n\n    /**\n     * 绑定/渲染模式\n     * @type {String}\n     * @note \"active\"模式: 指定ref和$el之间的relation，主动进行双向绑定，不依赖于dom标签中的属性和模板；\n     *           绑定逻辑可分离为配置对象；可以达到渲染和绑定分离的目的，所以如果是SSR或第三方UI组件则\n     *           更推荐这种模式.\n     *       \"passive\"模式: 依赖于dom标签内定义的属性和模板，进行解析；渲染与绑定逻辑耦合，模板即组件.\n     */\n    var mode = Util.isObject(relation) ? 'active' : 'passive';\n\n    if (mode === 'active') {\n        Util.each(relation, function (v, p) {\n            switch (p) {\n                case 'model':\n                    applyRelation(ref, v, true)(function () {\n                        // TODO\n                    });\n                    break;\n                case 'show':\n                    applyRelation(ref, v)(function (v) {\n                        $el.style.display = v ? 'block' : 'none';\n                    });\n                    break;\n                case 'style':\n                    applyRelation(ref, v)(function (v) {\n                        $el['cssText'] = v;\n                    });\n                    break;\n                case 'innerText':\n                case 'innerHTML':\n                case 'className':\n                    applyRelation(ref, v)(function (v) {\n                        $el[p] = v;\n                    });\n                    break;\n                default:\n                    var pNum = parseInt(p);\n                    if (!isNaN(pNum)) { /* Node Index */\n                    } else if (Util.isEventName(p)) { /* Event */\n                        $el.addEventListener(p, v, false);\n                    } else if (Util.isCSSSelector(p)) { /* CSS Selector */\n                        var children = Array.prototype.slice.call($el.querySelectorAll(p), 0);\n                        Util.each(children, function (dom) {\n                            Bind(ref, dom, v);\n                        });\n                    } else { /* Attribute */\n                        applyRelation(ref, v)(function (v) {\n                            $el.setAttribute(p, v);\n                        });\n                    }\n            }\n        });\n    } else {\n        if ($el.nodeType === Node.ELEMENT_NODE) {\n            Util.each($el.attributes, function (value, name) {\n                if (!name.startsWith(_this.attrPrefix)) return;\n                name = name.substr(_this.attrPrefix.length);\n                switch (name) {\n                    case 'model':\n                        break;\n                    case 'show':\n                        break;\n                    case 'text':\n                        break;\n                    case 'html':\n                        break;\n                    case 'class':\n                        break;\n                    case 'style':\n                        break;\n                    default:\n                        if (Util.isEventName(name)) { /* Event */\n                        } else { /* Attribute */\n                        }\n                }\n            });\n            Util.each($el, function (node) {\n                Bind(ref, node);\n            });\n        } else if ($el.nodeType === Node.TEXT_NODE) {\n            // TODO\n        }\n    }\n}\n\n/**\n * Unbind data from DOM.\n * @param       {[type]} ref      [description]\n * @param       {[type]} $el      [description]\n * @param       {[type]} relation [description]\n * @constructor\n */\nfunction Unbind(ref, $el, relation) {\n    // TODO\n}\n\n/**\n * Default configurations.\n * @type {Object}\n */\nvar DefaultConf = {\n    attrPrefix: 'm-',\n    refSeparator: '/',\n    tmplGrammer: 'dollarbrace',\n    tmplEngine: {\n        parseDeps: function (tmpl) {\n\n        },\n        classParser: function () {},\n        styleParser: function () {},\n        eventParser: function () {},\n        attrValueParser: function () {},\n        textValueParser: function (tmpl, executor) {\n            return tmpl.replace(/{([^{}]*)}/ig, function (match, p1, offset, string) {\n                return executor(p1);\n            });\n        }\n    }\n};\n\nDMD_Constructor: {\n    var DMD = function ($el, option) {\n        this.$el = $el || window.document.body;\n\n        this.defaults = {};\n        Util.extend(this.defaults, DefaultConf, option);\n    };\n\n    DMD.prototype.alias = function (map) {\n        return Alias(map, this.$el);\n    };\n\n    DMD.prototype.bind = function (ref, relation) {\n        return Bind(ref, this.$el, relation);\n    };\n}\n\nDMD_Factory: {\n    var factory = function ($el, option) {\n        return new DMD($el, option);\n    };\n    factory.defaults = Util.clone(DefaultConf);\n    factory.alias = Alias;\n    factory.data = BindData;\n    factory.bind = Bind;\n}\n\nexport default factory\n","/* If any, here they are. */\n\n/**\n * Array.prototype.map\n * @refer https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/map#Polyfill\n */\n// Production steps of ECMA-262, Edition 5, 15.4.4.19\n// Reference: http://es5.github.io/#x15.4.4.19\nif (!Array.prototype.map) {\n    Array.prototype.map = function(callback /*, thisArg*/ ) {\n        var T, A, k;\n\n        if (this == null) {\n            throw new TypeError('this is null or not defined');\n        }\n\n        // 1. Let O be the result of calling ToObject passing the |this|\n        //    value as the argument.\n        var O = Object(this);\n\n        // 2. Let lenValue be the result of calling the Get internal\n        //    method of O with the argument \"length\".\n        // 3. Let len be ToUint32(lenValue).\n        var len = O.length >>> 0;\n\n        // 4. If IsCallable(callback) is false, throw a TypeError exception.\n        // See: http://es5.github.com/#x9.11\n        if (typeof callback !== 'function') {\n            throw new TypeError(callback + ' is not a function');\n        }\n\n        // 5. If thisArg was supplied, let T be thisArg; else let T be undefined.\n        if (arguments.length > 1) {\n            T = arguments[1];\n        }\n\n        // 6. Let A be a new array created as if by the expression new Array(len)\n        //    where Array is the standard built-in constructor with that name and\n        //    len is the value of len.\n        A = new Array(len);\n\n        // 7. Let k be 0\n        k = 0;\n\n        // 8. Repeat, while k < len\n        while (k < len) {\n            var kValue, mappedValue;\n\n            // a. Let Pk be ToString(k).\n            //   This is implicit for LHS operands of the in operator\n            // b. Let kPresent be the result of calling the HasProperty internal\n            //    method of O with argument Pk.\n            //   This step can be combined with c\n            // c. If kPresent is true, then\n            if (k in O) {\n                // i. Let kValue be the result of calling the Get internal\n                //    method of O with argument Pk.\n                kValue = O[k];\n\n                // ii. Let mappedValue be the result of calling the Call internal\n                //     method of callback with T as the this value and argument\n                //     list containing kValue, k, and O.\n                mappedValue = callback.call(T, kValue, k, O);\n\n                // iii. Call the DefineOwnProperty internal method of A with arguments\n                // Pk, Property Descriptor\n                // { Value: mappedValue,\n                //   Writable: true,\n                //   Enumerable: true,\n                //   Configurable: true },\n                // and false.\n\n                // In browsers that support Object.defineProperty, use the following:\n                // Object.defineProperty(A, k, {\n                //   value: mappedValue,\n                //   writable: true,\n                //   enumerable: true,\n                //   configurable: true\n                // });\n\n                // For best browser support, use the following:\n                A[k] = mappedValue;\n            }\n            // d. Increase k by 1.\n            k++;\n        }\n\n        // 9. return A\n        return A;\n    };\n}\n\n/**\n * Array.prototype.filter\n * @refer https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/filter#Polyfill\n */\nif (!Array.prototype.filter) {\n    Array.prototype.filter = function(func, thisArg) {\n        if (!((typeof func === 'Function') && this))\n            throw new TypeError();\n\n        var len = this.length >>> 0,\n            res = new Array(len), // preallocate array\n            c = 0,\n            i = -1;\n        if (thisArg === undefined)\n            while (++i !== len)\n            // checks to see if the key was set\n                if (i in this)\n                if (func(t[i], i, t))\n                    res[c++] = t[i];\n                else\n                    while (++i !== len)\n                    // checks to see if the key was set\n                        if (i in this)\n                        if (func.call(thisArg, t[i], i, t))\n                            res[c++] = t[i];\n\n        res.length = c; // shrink down array to proper size\n        return res;\n    };\n}\n","var gid = (function () {\n    var n = 0;\n    return function () {\n        return n++;\n    };\n})();\n\nvar isBoolean = function (v) {\n    return typeof v === 'boolean';\n};\n\nvar isNumber = function (v) {\n    return typeof v === 'number';\n};\n\nvar isNumeric = function (v) {\n    var n = parseInt(v);\n    if (isNaN(n)) return false;\n    return (typeof v === 'number' || typeof v === 'string') && n == v;\n};\n\nvar isString = function (v) {\n    return typeof v === 'string';\n};\n\nvar isFunction = function (v) {\n    return typeof v === 'function';\n};\n\nvar isObject = function (v) {\n    return Object.prototype.toString.call(v) === '[object Object]';\n};\n\nvar isArray = function (v) {\n    return Object.prototype.toString.call(v) === '[object Array]';\n};\n\nvar isBasic = function (v) {\n    return v == null\n        || typeof v === 'boolean'\n        || typeof v === 'number'\n        || typeof v === 'string'\n        || typeof v === 'function';\n};\n\nvar isInstance = function (v, creator) {\n    return typeof creator === 'function' && v instanceof creator;\n};\n\nvar isDirectInstance = function (v, creator) {\n    return v.constructor === creator;\n};\n\nvar isNode = function (v) {\n    return v instanceof Node;\n};\n\nvar isNamedNodeMap = function (v) {\n    return v instanceof NamedNodeMap;\n};\n\nvar isEventName = function (v) {\n    if (!isString(v)) return false;\n    return v.startsWith('on'); // TODO\n};\n\nvar isCSSSelector = function (v) {\n    return v.indexOf(' ') > 0 || v.indexOf('.') >= 0\n        || v.indexOf('[') >= 0 || v.indexOf('#') >= 0;\n};\n\nvar each = function (v, func, arrayReverse) {\n    if (isObject(v)) {\n        for (var p in v) {\n            if (!v.hasOwnProperty(p)) continue;\n            var r = func(v[p], p);\n            if (r === false) break;\n        }\n    } else if (isArray(v)) {\n        if (!arrayReverse) {\n            for (var i = 0, len = v.length; i < len; i++) {\n                var r = func(v[i], i);\n                if (r === false) break;\n            }\n        } else {\n            for (var i = v.length - 1; i >= 0; i--) {\n                var r = func(v[i], i);\n                if (r === false) break;\n            }\n        }\n    } else if (isNode(v)) {\n        var ret = false;\n        switch (v.nodeType) {\n            case Node.ELEMENT_NODE:\n                break;\n            case Node.TEXT_NODE:\n            case Node.COMMENT_NODE:\n            case Node.PROCESSING_INSTRUCTION_NODE:\n            case Node.DOCUMENT_NODE:\n            case Node.DOCUMENT_TYPE_NODE:\n            case Node.DOCUMENT_FRAGMENT_NODE:\n            default:\n                ret = true;\n        }\n        if (ret) return;\n        for (var i = 0, childNodes = v.childNodes, len = v.childNodes.length; i < len; i++) {\n            func(childNodes[i]);\n            each(childNodes[i], func);\n        }\n    } else if (isNamedNodeMap(v)) {\n        for (var i = 0, len = v.length; i < len; i++) {\n            var r = func(v[i]['nodeValue'], v[i]['nodeName']);\n            if (r === false) break;\n        }\n    } else if (Util.isFunction(v.forEach)) {\n        v.forEach(func);\n    }\n};\n\nvar eachUnique = function (arr, func) {\n    if (!isArray(arr)) return;\n    var map = {};\n    for (var i = 0, len = arr.length; i < len; i++) {\n        if (!isNumber(arr[i]) || !isString(arr[i]) || map[arr[i]]) continue;\n        map[arr[i]] = true;\n        var r = func(arr[i]);\n        if (r === false) break;\n    }\n};\n\nvar unique = function (arr) {\n    var r = [];\n    eachUnique(arr, function (v) {\n        r.push(v);\n    });\n    return r;\n};\n\nvar clone = function (val) {\n    var r = val;\n    if (isObject(val)) {\n        r = {};\n        each(val, function (v, p) {\n            r[p] = clone(v);\n        });\n    } else if (isArray(val)) {\n        r = [];\n        each(val, function (v) {\n            r.push(clone(v));\n        });\n    }\n    return r;\n};\n\nvar hasProperty = function (val, p) {\n    if (isObject(val)) {\n        return val.hasOwnProperty(p);\n    } else if (isArray(val)) {\n        var n = parseInt(p);\n        return isNumeric(p) && val.length > n && n >= 0;\n    }\n    return false;\n};\n\nvar clear = function (val, p, withBasicVal) {\n    var inRef = isString(p) || isNumber(p);\n    var target = inRef ? val[p] : val;\n\n    if (isObject(target) || isArray(target)) {\n        each(target, function (v, p) {\n            clear(target, p);\n        });\n        if (isArray(target)) {\n            shrinkArray(target);\n        }\n    }\n\n    if (inRef) {\n        val[p] = withBasicVal;\n    }\n};\n\nvar shrinkArray = function (arr, len) {\n    var limited = isNumber(len);\n    if (!limited) {\n        each(arr, function (v, i) {\n            if (v === undefined) arr.length--;\n        }, true);\n    } else {\n        each(arr, function (v, i) {\n            if (i >= len) arr.length--;\n            else return false;\n        }, true);\n        while (arr.length < len) {\n            arr.push(null);\n        }\n    }\n    return arr;\n};\n\nvar touchLeaves = function (obj) {\n    each(obj, function (v, p) {\n        if (isBasic(v)) {\n            obj[p] = v;\n        } else {\n            touchLeaves(v);\n        }\n    });\n};\n\nvar extend = function (dest, srcs, clean) {\n    if (!isObject(dest)) return null;\n    var args = Array.prototype.slice.call(arguments, 1,\n        arguments[arguments.length - 1] === true ? (arguments.length - 1) : arguments.length);\n\n    function extendObj(obj, src, clean) {\n        if (!isObject(src)) return;\n        each(src, function (v, p) {\n            if (!hasProperty(obj, p) || isBasic(v)) {\n                if (obj[p] !== v) {\n                    obj[p] = clone(v);\n                }\n            } else {\n                extendObj(obj[p], v, clean);\n            }\n        });\n        if (clean) {\n            each(obj, function (v, p) {\n                if (!hasProperty(src, p)) {\n                    clear(obj, p);\n                }\n            });\n            if (isArray(obj)) {\n                shrinkArray(obj);\n            }\n        }\n    }\n\n    each(args, function (src) {\n        extendObj(dest, src, clean);\n    });\n    return dest;\n};\n\nexport {\n    gid,\n    isBoolean,\n    isNumber,\n    isNumeric,\n    isString,\n    isFunction,\n    isObject,\n    isArray,\n    isBasic,\n    isInstance,\n    isDirectInstance,\n    isNode,\n    isNamedNodeMap,\n    isEventName,\n    isCSSSelector,\n    each,\n    eachUnique,\n    unique,\n    clone,\n    hasProperty,\n    clear,\n    shrinkArray,\n    touchLeaves,\n    extend\n}\n","import * as Util from './Util'\n\n/**\n * Alias DOM constructor function.\n * @param  {Object|String} map              Selector-alias map.\n * @param  {HTMLElement|Undefined} $el      Root element.\n * @return {Object}                         Result table.\n */\nvar AliasDOM = function (map, $el) {\n    var ifJoinAlias = !!map.join;\n    var aliasSeparator = '/';\n\n    function isKeyword(w) {\n        return w === 'alias' || w === 'lazy' || w === 'join';\n    }\n\n    (function lazyDown(map) {\n        if (!Util.isObject(map)) return;\n        if (map.lazy) {\n            Util.each(map, function (v, p) {\n                if (isKeyword(p)) return;\n                if (Util.isString(v)) {\n                    map[p] = {\n                        alias: v,\n                        lazy: true\n                    };\n                } else if (Util.isObject(v)) {\n                    v.lazy = true;\n                }\n            });\n        }\n        Util.each(map, lazyDown);\n    })(map);\n\n    (function alias(map, $root, obj, fullSel, fullAlias) {\n        map = Util.isString(map) ? { alias: map } : (Util.isObject(map) ? map : {});\n        $root = $root || window.document.body;\n        obj = obj || {};\n        !obj.__root && Object.defineProperty(obj, '__root', { value: $root });\n        fullSel = fullSel || [];\n        fullAlias = fullAlias || [];\n\n        function querySelector($parent, sel) {\n            if (!sel) return $parent;\n            var $targets = Array.prototype.slice.call($parent.querySelectorAll(sel));\n            if ($targets.length < 1) return null;\n            if ($targets.length === 1) return $targets[0];\n            return $targets;\n        }\n\n        if (map.alias) {\n            fullAlias = fullAlias.concat(map.alias);\n            var aliasProperty = ifJoinAlias ? fullAlias.join(aliasSeparator) : map.alias;\n            if (map.lazy) {\n                Object.defineProperty(obj, aliasProperty, {\n                    get: function () {\n                        return querySelector(this.__root, fullSel.join(' '));\n                    },\n                    enumerable: true\n                });\n            } else {\n                obj[aliasProperty] = querySelector($root, fullSel.join(' '));\n            }\n        }\n\n        Util.each(map, function (v, sel) {\n            if (isKeyword(sel)) return;\n            alias(v, $root, obj, fullSel.concat(sel), fullAlias);\n        });\n\n        return obj;\n    })(map, $el, this);\n};\n\n/**\n * Alias DOM factory function.\n */\nvar Alias = function (map, $el) {\n    return new AliasDOM(map, $el);\n};\n\nexport { AliasDOM, Alias }\n","import * as Util from './Util'\n\nvar canUseProxy = typeof Proxy === 'function';\n\nvar OArray = function (arr, option) {\n    if (!Util.isArray(arr)) arr = [];\n    if (!Util.isObject(option)) option = {};\n\n    Object.defineProperty(this, 'afterInsertElement', {\n        value: option.afterInsertElement || function (target, p) {}\n    });\n    Object.defineProperty(this, 'beforeDeleteElement', {\n        value: option.beforeDeleteElement || function (target, p) {}\n    });\n    Object.defineProperty(this, 'elementEquality', {\n        value: option.elementEquality || function (v1, v2) { return v1 === v2; }\n    });\n\n    var len = 0;\n    Object.defineProperty(this, '__length', {\n        get: function () {\n            return len;\n        },\n        set: function (v) {\n            return len = v;\n        }\n    });\n    Object.defineProperty(this, 'length', {\n        get: function () {\n            return this.__length;\n        },\n        set: function (v) {\n            if (!Util.isNumber(v)) return false;\n            var n = parseInt(v);\n            if (isNaN(n) || n < 0) return false;\n            if (n > this.__length) {\n                for (var i = this.__length; i < n; i++)\n                    this.push(undefined);\n            } else if (n < this.__length) {\n                for (var i = this.__length - 1; i >= n; i--)\n                    this.pop();\n            }\n            return this.__length;\n        }\n    });\n\n    var extendable = false;\n    Object.defineProperty(this, '__extendable', {\n        get: function () {\n            return extendable;\n        },\n        set: function (v) {\n            return extendable = !!v;\n        }\n    });\n\n    var _this = this;\n    this.__extendable = true;\n    Util.each(arr, function (v, i) {\n        _this.push(v);\n    });\n    this.__extendable = false;\n};\n\nOArray.prototype = [];\nOArray.prototype.constructor = OArray;\n\nOArray.prototype.assignElement = function (i, val) {\n    if (!Util.isNumber(i)) return false;\n    if (this.hasOwnProperty(i)) {\n        this[i] = val;\n    } else if (this.__extendable) {\n        var v = val;\n        Object.defineProperty(this, i, {\n            get: function () {\n                return v;\n            },\n            set: function (_v) {\n                return v = _v;\n            },\n            configurable: true,\n            enumerable: true\n        });\n    } else {\n        return false;\n    }\n};\n\nOArray.prototype.deleteElement = function (i) {\n    if (!Util.isNumber(i) || !this.hasOwnProperty(i)) return false;\n    delete this[i];\n    return true;\n};\n\nOArray.prototype.push = function (v) {\n    this.__extendable = true;\n    this.assignElement(this.__length, v);\n    this.__extendable = false;\n    this.__length++;\n    return this.__length;\n};\n\nOArray.prototype.pop = function (v) {\n    var re = (this.__length > 0) ? this[this.__length - 1] : undefined;\n    if (this.deleteElement(this.__length - 1)) this.__length -= 1;\n    return re;\n};\n\nOArray.prototype.offset = function (startIndex, howManyElements, howManySteps, notClean) {\n    if (!Util.isNumber(startIndex) || startIndex < 0 || startIndex >= this.__length) return false;\n    if (!Util.isNumber(howManySteps) || howManySteps === 0) return false;\n    if (!Util.isNumber(howManyElements) || howManyElements <= 0\n        || howManyElements + startIndex > this.__length) howManyElements = this.__length - startIndex;\n    this.__extendable = true;\n    if (howManySteps > 0) { /* to right */\n        for (var i = startIndex + howManyElements - 1 + howManySteps; i >= startIndex + howManySteps; i--) {\n            this.assignElement(i, this[i - howManySteps]);\n        }\n        if (!notClean) {\n            for (var i = startIndex; i < startIndex + howManySteps; i++) {\n                this.assignElement(i, undefined);\n            }\n        }\n        if (startIndex + howManyElements + howManySteps > this.__length) {\n            this.__length = startIndex + howManyElements + howManySteps;\n        }\n    } else { /* to left */\n        for (var i = Math.max(0, startIndex + howManySteps); i < startIndex + howManyElements + howManySteps; i++) {\n            this.assignElement(i, this[i - howManySteps]);\n        }\n        for (var i = Math.max(0, startIndex + howManyElements + howManySteps);\n            i < startIndex + howManyElements; i++) {\n            this.assignElement(i, undefined);\n        }\n        if (startIndex + howManyElements >= this.__length) {\n            this.length = Math.max(0, startIndex + howManyElements + howManySteps);\n        }\n    }\n    this.__extendable = false;\n};\n\nOArray.prototype.unshift = function (v) {\n    this.offset(0, null, 1);\n    this.__extendable = true;\n    this.assignElement(0, v);\n    this.__extendable = false;\n    return this.__length;\n};\n\nOArray.prototype.shift = function (v) {\n    var re = (this.__length > 0) ? this[0] : undefined;\n    this.offset(0, null, -1);\n    return re;\n};\n\nOArray.prototype.toArray = function (notClone) {\n    var r = [];\n    this.forEach(function (v, i) {\n        r.push(notClone ? v : Util.clone(v));\n    });\n    return r;\n};\n\nOArray.prototype.splice = function (startIndex, howManyToDelete, itemToInsert) {\n    if (!Util.isNumber(startIndex)) return [];\n    if (startIndex < 0 || startIndex >= this.__length) return [];\n    if (!Util.isNumber(howManyToDelete) || howManyToDelete < 0) howManyToDelete = 0;\n    if (howManyToDelete + startIndex > this.__length) howManyToDelete = this.__length - startIndex;\n\n    var r = [];\n    for (var i = startIndex; i < startIndex + howManyToDelete; i++) {\n        r.push(Util.clone(this[i]));\n    }\n\n    var itemsToInsert = Array.prototype.slice.call(arguments, 2);\n    var howManyToInsert = itemsToInsert.length;\n\n    this.__extendable = true;\n    if (howManyToDelete >= howManyToInsert) {\n        if (startIndex + howManyToDelete === this.__length) {\n            for (var i = 0; i < howManyToDelete - howManyToInsert; i++) {\n                this.pop();\n            }\n        } else {\n            this.offset(startIndex + howManyToDelete, null, howManyToInsert - howManyToDelete);\n        }\n        for (var i = startIndex; i < startIndex + howManyToInsert; i++) {\n            this.assignElement(i, itemsToInsert[i - startIndex]);\n        }\n    } else if (howManyToDelete < howManyToInsert) {\n        if (startIndex + howManyToDelete === this.__length) {\n            this.__length = startIndex + howManyToInsert;\n        } else {\n            this.offset(startIndex + howManyToDelete, null, howManyToInsert - howManyToDelete, true);\n        }\n        for (var i = startIndex; i < startIndex + howManyToInsert; i++) {\n            this.assignElement(i, itemsToInsert[i - startIndex]);\n        }\n    }\n    this.__extendable = false;\n\n    return r;\n};\n\nOArray.prototype.slice = function (startIndex, endIndex, notClone) {\n    if (!Util.isNumber(startIndex)) return [];\n    if (!Util.isNumber(endIndex)) endIndex = this.__length;\n    if (startIndex < 0 || endIndex > this.__length || startIndex >= endIndex) return [];\n    var r = [];\n    for (var i = startIndex; i < endIndex; i++) {\n        r.push(notClone ? this[i] : Util.clone(this[i]));\n    }\n    return r;\n};\n\nOArray.prototype.concat = function () {\n    return Array.prototype.concat.apply(this.toArray(), arguments);\n};\n\nOArray.prototype.reverse = function () {\n    var m = Math.floor((this.__length - 1) / 2);\n    for (var i = 0; i <= m; i++) {\n        var j = this.__length - 1 - i;\n        var vi = Util.clone(this[i]);\n        var vj = Util.clone(this[j]);\n        this[i] = vj;\n        this[j] = vi;\n    }\n};\n\nOArray.prototype.sort = function (sortBy) {};\n\nOArray.prototype.forEach = function (fn) {\n    for (var i = 0; i < this.__length; i++) {\n        var r = fn(this[i], i);\n        if (r === false) break;\n    }\n};\n\nOArray.prototype.filter = function () {\n    return Array.prototype.filter.apply(this.toArray(), arguments);\n};\n\nOArray.prototype.map = function () {\n    return Array.prototype.map.apply(this.toArray(), arguments);\n};\n\nOArray.prototype.reduce = function () {\n    return Array.prototype.reduce.apply(this.toArray(), arguments);\n};\n\nOArray.prototype.indexOf = function (v) {\n    // TODO: optimization\n    return Array.prototype.indexOf.apply(this.toArray(), arguments);\n};\n\nOArray.prototype.find = function (v) {\n    // TODO: optimization\n    return Array.prototype.find.apply(this.toArray(), arguments);\n};\n\nOArray.prototype.findIndex = function (v) {\n    // TODO: optimization\n    return Array.prototype.findIndex.apply(this.toArray(), arguments);\n};\n\nOArray.prototype.fill = function (v) {\n    this.forEach(function (e, i) {\n        this.assignElement(i, v);\n    });\n};\n\nOArray.prototype.join = function () {\n    return Array.prototype.join.apply(this.toArray(), arguments);\n};\n\nexport default OArray\n","import * as Util from './Util'\nimport OArray from './ObservableArray'\n\nvar idPropertyName = '__DMD_DARK_REF';\nvar refSpace = {};\n\n/**\n * Bind an object data into a reference space.\n * @param  {Object} data                [description]\n * @param  {Boolean} force              [description]\n * @return {[type]}                     [description]\n */\nvar BindData = function (data, force) {\n    if (!Util.isObject(data)) return refSpace;\n    if (data[idPropertyName] !== undefined && !force) return refSpace;\n\n    Object.defineProperty(data, idPropertyName, {\n        value: Util.gid()\n    });\n\n    refSpace[data[idPropertyName]] = {\n        data: data,\n        props: {}\n    };\n    var rootNode = refSpace[data[idPropertyName]];\n\n    function bindProps(node, obj) {\n        if (!Util.isObject(obj)) return;\n        if (!node.props) node.props = {};\n        Util.each(obj, function (v, p) {\n            if (!node.props[p]) {\n                node.props[p] = {\n                    setters: []\n                };\n            }\n            bindProps(node.props[p], v);\n        });\n    }\n    bindProps(rootNode, data);\n\n    function bindSetters(node, obj) {\n        Util.each(obj, function (v, p) {\n            if (delete obj[p] === false) return;\n            Object.defineProperty(obj, p, {\n                get: function () {\n                    return v;\n                },\n                set: function (_v) {\n                    function execSetters(node, newV, oldv) {\n                        Util.each(node.setters, function (setter) {\n                            setter(newV, oldv);\n                        });\n                    }\n                    execSetters(node.props[p], _v, v);\n\n                    if (Util.isBasic(_v)) {\n                        Util.clear(obj, p, _v);\n                    } else {\n                        bindProps(node.props[p], _v);\n                        bindSetters(node.props[p], _v);\n                        if (Util.isBasic(v)) {\n                            v = _v;\n                            Util.touchLeaves(v);\n                        } else {\n                            Util.extend(v, _v, true);\n                        }\n                    }\n                },\n                enumerable: true\n            });\n            bindSetters(node.props[p], v);\n        });\n    }\n    bindSetters(rootNode, data);\n\n    return refSpace;\n};\n\nvar GetBinding = function (data, refPath) {\n    if (!data[idPropertyName]) {\n        BindData(data);\n    }\n    var node = refSpace[data[idPropertyName]];\n    var paths = [];\n    if (refPath) paths = refPath.split('.');\n    while (paths.length) {\n        node = node.props[path.shift()];\n    }\n    return node;\n};\n\nvar GetData = function (data, refPath) {\n    var v = data;\n    var paths = [];\n    if (refPath) paths = refPath.split('.');\n    while (paths.length) {\n        v = v[path.shift()];\n    }\n    return v;\n};\n\nexport { BindData, GetBinding, GetData }\n"],"names":["Bind","ref","$el","relation","depsAndCalc","rel","deps","calc","v","Util.isString","push","GetData","Util.isArray","Util.isFunction","length","slice","filter","parts","Util.each","Util.isObject","r","p","de","concat","obj","re","e","call","join","applyRelation","loop","Util.unique","map","GetBinding","relate","dep","setters","BindData","_this","this","Util.isInstance","AliasDOM","dom","a","Util.isNode","style","display","pNum","parseInt","isNaN","Util.isEventName","addEventListener","Util.isCSSSelector","children","Array","prototype","querySelectorAll","setAttribute","nodeType","Node","ELEMENT_NODE","attributes","value","name","startsWith","attrPrefix","substr","node","TEXT_NODE","callback","T","A","k","TypeError","O","Object","len","arguments","kValue","mappedValue","func","thisArg","res","c","i","undefined","t","gid","n","isNumber","isNumeric","isString","isFunction","isObject","toString","isArray","isBasic","isInstance","creator","isNode","isNamedNodeMap","NamedNodeMap","isEventName","isCSSSelector","indexOf","each","arrayReverse","hasOwnProperty","ret","COMMENT_NODE","PROCESSING_INSTRUCTION_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","childNodes","Util","forEach","eachUnique","arr","unique","clone","val","hasProperty","clear","withBasicVal","inRef","target","shrinkArray","touchLeaves","extend","dest","srcs","clean","extendObj","src","args","isKeyword","w","ifJoinAlias","lazyDown","lazy","alias","$root","fullSel","fullAlias","querySelector","$parent","sel","$targets","window","document","body","__root","defineProperty","aliasProperty","get","enumerable","Alias","OArray","option","afterInsertElement","beforeDeleteElement","elementEquality","v1","v2","set","__length","Util.isNumber","pop","extendable","__extendable","constructor","assignElement","_v","configurable","deleteElement","offset","startIndex","howManyElements","howManySteps","notClean","Math","max","unshift","shift","toArray","notClone","Util.clone","splice","howManyToDelete","itemToInsert","itemsToInsert","howManyToInsert","endIndex","apply","reverse","m","floor","j","vi","vj","sort","sortBy","fn","reduce","find","findIndex","fill","refSpace","data","force","bindProps","props","bindSetters","newV","oldv","setter","execSetters","Util.isBasic","Util.clear","Util.touchLeaves","Util.extend","Util.gid","rootNode","refPath","paths","split","path","DefaultConf","refSeparator","tmplGrammer","tmplEngine","parseDeps","tmpl","classParser","styleParser","eventParser","attrValueParser","textValueParser","executor","replace","match","p1","string","DMD","defaults","bind","factory"],"mappings":"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"}